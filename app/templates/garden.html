{% extends "layout.html" %}
{% block title %}The Garden - NutriMind{% endblock %}

{% block content %}
<div class="flex-1 flex flex-col p-6 overflow-y-auto hide-scrollbar">

    <header class="flex justify-between items-end mb-8">
        <div>
            <h1 class="text-3xl font-display font-bold text-text-main dark:text-text-bright">The Garden</h1>
            <p class="text-xs font-bold text-primary uppercase tracking-widest mt-1">Twilight Cycle</p>
        </div>
        <div
            class="flex items-center gap-1 bg-surface dark:bg-twilight-surface px-3 py-1.5 rounded-full border border-white/50 dark:border-white/5 shadow-soft">
            <span class="text-xl">ðŸ”¥</span>
            <span class="font-bold text-text-main dark:text-text-bright">{{ streak_days }}</span>
            <span class="text-xs text-text-muted font-bold ml-1">Day{{ 's' if streak_days != 1 }}</span>
        </div>
    </header>

    <!-- Weekly Calendar -->
    <div
        class="bg-surface dark:bg-twilight-surface rounded-pod p-5 shadow-soft border border-white/40 dark:border-white/5 mb-8">
        <div class="flex justify-between items-end mb-6">
            <div>
                <h2 class="font-display font-bold text-lg text-text-main dark:text-text-bright">Weekly Bloom</h2>
                <p class="text-sm text-text-muted">Target: <span class="text-primary font-bold">{{ target_kcal }}
                        kcal</span></p>
            </div>
            {% set week_avg = (days_data | sum(attribute='kcal')) / 7 if days_data else 0 %}
            {% if week_avg >= target_kcal * 0.8 and week_avg <= target_kcal * 1.1 %} <span
                class="text-xs font-bold text-neon-green bg-neon-green/10 px-2 py-1 rounded">On Track</span>
                {% elif week_avg < target_kcal * 0.8 %} <span
                    class="text-xs font-bold text-orange-400 bg-orange-400/10 px-2 py-1 rounded">Under Target</span>
                    {% else %}
                    <span class="text-xs font-bold text-red-400 bg-red-400/10 px-2 py-1 rounded">Over Target</span>
                    {% endif %}
        </div>

        <div class="grid grid-cols-7 gap-2">
            <!-- Day Columns -->
            {% for day in days_data %}
            <div class="flex flex-col items-center gap-2 group">
                <!-- Bar (Plant Stem) -->
                <div
                    class="relative w-1.5 h-16 bg-surface-alt dark:bg-white/5 rounded-full flex items-end justify-center overflow-hidden">
                    {% set pct = (day.kcal / (day.target or 2000)) * 100 %}
                    <div class="w-full bg-primary/40 dark:bg-primary transition-all duration-1000 group-hover:bg-neon-green"
                        style="height: {{ [pct, 100] | min }}%"></div>
                </div>
                <!-- Label -->
                <span
                    class="text-[10px] font-bold uppercase {{ 'text-primary' if day.is_today else 'text-text-muted' }}">{{
                    day.weekday }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Growth Tasks -->
    <h3 class="font-display font-bold text-lg text-text-main dark:text-text-bright mb-4">Nurture Seeds</h3>

    <div class="space-y-3">
        <!-- Task 1: Hydration (placeholder â€” no tracking system yet) -->
        <div
            class="bg-surface dark:bg-twilight-surface rounded-2xl p-4 flex items-center justify-between shadow-soft border border-white/40 dark:border-white/5 group hover:border-primary/50 transition-all">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-full bg-blue-500/10 text-blue-500 flex items-center justify-center">
                    <span class="material-symbols-outlined text-xl">water_drop</span>
                </div>
                <div>
                    <h4 class="font-bold text-text-main dark:text-text-bright text-sm">Hydration</h4>
                    <p class="text-xs text-text-muted italic">Coming soon</p>
                </div>
            </div>
            <div
                class="w-8 h-8 rounded-full bg-surface-alt dark:bg-white/5 flex items-center justify-center text-text-muted opacity-50">
                <span class="material-symbols-outlined text-sm">lock</span>
            </div>
        </div>

        <!-- Task 2: Protein -->
        <div
            class="bg-surface dark:bg-twilight-surface rounded-2xl p-4 flex items-center justify-between shadow-soft border border-white/40 dark:border-white/5 group hover:border-primary/50 transition-all">
            <div class="flex items-center gap-4">
                <div class="w-10 h-10 rounded-full bg-accent-protein/20 text-red-400 flex items-center justify-center">
                    <span class="material-symbols-outlined text-xl">fitness_center</span>
                </div>
                <div>
                    <h4 class="font-bold text-text-main dark:text-text-bright text-sm">Protein Goal</h4>
                    <p class="text-xs text-text-muted">{{ today_protein | round(1) }}g / {{ target_protein }}g</p>
                </div>
            </div>
            <div class="w-8 h-8 rounded-full bg-green-500/20 text-green-500 flex items-center justify-center">
                {% if today_protein >= target_protein %}
                <span class="material-symbols-outlined text-sm font-bold">check</span>
                {% else %}
                <span class="text-xs font-bold">...</span>
                {% endif %}
            </div>
        </div>

    </div>

</div>
{% endblock %}